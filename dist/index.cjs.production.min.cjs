"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("crlf-normalize"),e=require("fast-xml-parser");function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const n=/\d+$/,o=/(\(|\[)([a-z].+)(\)|\])/i;function i(t){let e=(t=t.trim()).match(/^(\d+)x?\s+/);if(e){var r,i;const s=parseInt(e[1]),a=t.slice(e[0].length).replace(o,"").replace(n,"").trim(),l=null===(r=t.match(o))||void 0===r?void 0:r[2],c=null===(i=t.match(n))||void 0===i?void 0:i[0];return{name:a,amount:s,set:l,collectors:l&&c?parseInt(c):void 0}}throw new SyntaxError(`Invalid format: ${t}`)}function s(t){return[t.amount||1,a(t)].filter((t=>null!=t&&t)).join(" ")}function a(t){var e;return[t.name,null!==(e=t.set)&&void 0!==e&&e.length?`(${t.set})`:void 0,t.collectors].filter((t=>null!=t&&t)).join(" ")}function l(t){var e,r;let n=[];return t.commander&&(n.push("Commander"),n.push(t.commander.toCardString()),n.push("")),t.companion&&(n.push("Companion"),n.push(t.companion.toCardString()),n.push("")),null!==(e=t.deck)&&void 0!==e&&e.length&&(n.push("Deck"),t.deck.forEach((t=>{n.push(t.toCardString())})),n.push("")),null!==(r=t.sideboard)&&void 0!==r&&r.length&&(n.push("Sideboard"),t.sideboard.forEach((t=>{n.push(t.toCardString())})),n.push("")),n.join("\n")}class CardModel{constructor(t){const{amount:e,name:r,set:n,collectors:o,mtgoID:i}="string"==typeof t?this.parseString(t):this.parseObject(t);this.name=r,this.amount=e,this.set=n,this.collectors=o,this.mtgoID=i}parseString(t){return i(t)}parseObject(t){var e,r,n;let o=t.collectors;"string"==typeof o&&(o=parseInt(o));let i=0|parseInt(null!==(e=t.Quantity)&&void 0!==e?e:t.amount);return(!i||!Number.isInteger(i)||i<0)&&(i=void 0),{name:null!==(r=t.Name)&&void 0!==r?r:t.name,amount:i,mtgoID:null!==(n=t.CatID)&&void 0!==n?n:t.mtgoID,set:t.set,collectors:o}}toCardString(){return s(this)}}class AbstractDeck{constructor(){r(this,"valid",!1),r(this,"deck",[]),r(this,"sideboard",[]),r(this,"companion",null),r(this,"commander",null),this.valid=!1}toDeckListString(){return l(this)}_newCardModel(t,e){const r=new CardModel(t);return r.amount=null!=e?e:r.amount,r}}const c=Symbol.for("DecklistType");var d,u;!function(t){t.mtgo="mtgo",t.mtga="mtga",t.mtgify="mtgify"}(d||(d={})),function(t){t[t.unstarted=0]="unstarted",t[t.commander=1]="commander",t[t.companion=2]="companion",t[t.deck=3]="deck",t[t.sideboard=4]="sideboard"}(u||(u={}));const h=/^deck$/i,m=/^sideboard$/i,p=/^commander$/i,g=/^companion$/i;class Decklist extends AbstractDeck{constructor(e,n=!0){super(),r(this,c,"mtga");let o=t.lineSplit(e.toString().trim()),i=0;try{o.forEach((t=>{if((t=t.trim()).match(p))return void(i=1);if(t.match(g))return void(i=2);if(t.match(h))return void(i=3);if(0===i&&t.length>0)i=3;else{if(t.match(m)||3===i&&0===t.length)return void(i=4);if(0===t.length)return}let e=this._newCardModel(t);switch(i){case 1:this.commander=e;break;case 2:this.companion=e;break;case 3:this.deck.push(e);break;case 4:this.sideboard.push(e)}this.valid=!0}))}catch(t){this.valid=!1,n&&console.error(t)}}_newCardModel(t,e){return super._newCardModel(t,e)}}class MTGO extends AbstractDeck{constructor(t,n=!0){super(),r(this,c,"mtgo"),t=t.toString().trim();const o=e.validate(t);this.valid=!0===o,this.valid?e.parse(t,{attributeNamePrefix:"",ignoreAttributes:!1}).Deck.Cards.forEach((t=>{let e=this._newCardModel(t);"16777728"===t.Annotation?this.commander=e:"true"===t.Sideboard?this.sideboard.push(e):this.deck.push(e)})):n&&console.error(o.err)}_newCardModel(t,e){return super._newCardModel(t,e)}}class MtgifyDecklist extends AbstractDeck{constructor(e,n=!0){super(),r(this,c,"mtgify");let o=t.lineSplit(e.toString().trim());try{o.forEach((t=>{var e;let r=(t=t.trim()).match(/^(\d+)x\s+(.+)$/);null!=r&&null!==(e=r[1])&&void 0!==e&&e.length&&this.deck.push(this._newCardModel(t))})),this.valid=this.deck.length>0}catch(t){this.valid=!1,n&&console.error(t)}}_newCardModel(t,e){return super._newCardModel(t,e)}}function f(t){let e=new MTGO(t,!1);if(e.valid)return e;if(e=new Decklist(t,!1),e.valid)return e;let r=new MtgifyDecklist(t);return r.valid?r:e}exports.AbstractDeck=AbstractDeck,exports.CardModel=CardModel,exports.Decklist=Decklist,exports.MTGO=MTGO,exports.MtgifyDecklist=MtgifyDecklist,exports.SymDecklistType=c,exports.autoParse=f,exports.default=f,exports.parseString=i,exports.toCardString=s,exports.toCardStringWithoutAmount=a,exports.toDeckListString=l,exports.toMtgifyCardString=function(t){return[(t.amount||1)+"x",t.name].filter((t=>null!=t&&t)).join(" ")};
//# sourceMappingURL=index.cjs.production.min.cjs.map
