"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("crlf-normalize"),e=require("fast-xml-parser");function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const n=/\d+$/,i=/(\(|\[)(.+)(\)|\])/;function o(t){let e=(t=t.trim()).match(/^(\d+)x?\s+/);if(e){const r=parseInt(e[1]),o=t.slice(e[0].length).replace(i,"").replace(n,"").trim(),s=t.match(i),a=t.match(n);return{name:o,amount:r,set:s?s[2]:void 0,collectors:a?parseInt(a[0]):void 0}}throw new SyntaxError(`Invalid format: ${t}`)}function s(t){return[t.amount||1,a(t)].filter((t=>null!=t&&t)).join(" ")}function a(t){var e;return[t.name,null!==(e=t.set)&&void 0!==e&&e.length?`(${t.set})`:void 0,t.collectors].filter((t=>null!=t&&t)).join(" ")}function c(t){var e,r;let n=[];return t.commander&&(n.push("Commander"),n.push(t.commander.toCardString()),n.push("")),t.companion&&(n.push("Companion"),n.push(t.companion.toCardString()),n.push("")),null!==(e=t.deck)&&void 0!==e&&e.length&&(n.push("Deck"),t.deck.forEach((t=>{n.push(t.toCardString())})),n.push("")),null!==(r=t.sideboard)&&void 0!==r&&r.length&&(n.push("Sideboard"),t.sideboard.forEach((t=>{n.push(t.toCardString())})),n.push("")),n.join("\n")}class l{constructor(t){const{amount:e,name:r,set:n,collectors:i,mtgoID:o}="string"==typeof t?this.parseString(t):this.parseObject(t);this.name=r,this.amount=e,this.set=n,this.collectors=i,this.mtgoID=o}parseString(t){return o(t)}parseObject(t){var e,r,n;let i=t.collectors;"string"==typeof i&&(i=parseInt(i));let o=0|parseInt(null!==(e=t.Quantity)&&void 0!==e?e:t.amount);return(!o||!Number.isInteger(o)||o<0)&&(o=void 0),{name:null!==(r=t.Name)&&void 0!==r?r:t.name,amount:o,mtgoID:null!==(n=t.CatID)&&void 0!==n?n:t.mtgoID,set:t.set,collectors:i}}toCardString(){return s(this)}}class d{constructor(){r(this,"valid",!1),r(this,"deck",[]),r(this,"sideboard",[]),r(this,"companion",null),r(this,"commander",null)}toDeckListString(){return c(this)}}const u=Symbol.for("DecklistType");var h,m;!function(t){t.mtgo="mtgo",t.mtga="mtga",t.mtgify="mtgify"}(h||(h={})),function(t){t[t.unstarted=0]="unstarted",t[t.commander=1]="commander",t[t.companion=2]="companion",t[t.deck=3]="deck",t[t.sideboard=4]="sideboard"}(m||(m={}));const p=/^deck$/i,g=/^sideboard$/i,f=/^commander$/i,v=/^companion$/i;class b extends d{constructor(e,n=!0){super(),r(this,u,"mtga");let i=t.lineSplit(e.toString().trim()),o=0;try{i.forEach((t=>{if((t=t.trim()).match(f))o=1;else if(t.match(v))o=2;else if(t.match(p))o=3;else{if(0===o&&t.length>0)o=3;else{if(t.match(g)||3===o&&0===t.length)return void(o=4);if(0===t.length)return}switch(o){case 1:this.commander=new l(t);break;case 2:this.companion=new l(t);break;case 3:this.deck.push(new l(t));break;case 4:this.sideboard.push(new l(t))}}})),this.valid=!0}catch(t){this.valid=!1,n&&console.error(t)}}}class S extends d{constructor(t,n=!0){super(),r(this,u,"mtgo"),t=t.toString().trim();const i=e.validate(t);this.valid=!0===i,this.valid?e.parse(t,{attributeNamePrefix:"",ignoreAttributes:!1}).Deck.Cards.forEach((t=>{"16777728"===t.Annotation?this.commander=new l(t):"true"===t.Sideboard?this.sideboard.push(new l(t)):this.deck.push(new l(t))})):n&&console.error(i.err)}}class k extends d{constructor(e,n=!0){super(),r(this,u,"mtgify");let i=t.lineSplit(e.toString().trim());try{i.forEach((t=>{var e;let r=(t=t.trim()).match(/^(\d+)x\s+(.+)$/);null!=r&&null!==(e=r[1])&&void 0!==e&&e.length&&this.deck.push(new l(t))})),this.valid=this.deck.length>0}catch(t){this.valid=!1,n&&console.error(t)}}}function x(t){let e=new S(t,!1);if(e.valid)return e;if(e=new b(t,!1),e.valid)return e;let r=new k(t);return r.valid?r:e}exports.CardModel=l,exports.Decklist=b,exports.MTGO=S,exports.MtgifyDecklist=k,exports.autoParse=x,exports.default=x,exports.parseString=o,exports.toCardString=s,exports.toCardStringWithoutAmount=a,exports.toDeckListString=c;
//# sourceMappingURL=index.cjs.production.min.js.map
