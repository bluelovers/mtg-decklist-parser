"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("crlf-normalize"),e=require("fast-xml-parser");function r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const i=/\d+$/,n=/(\(|\[)([a-z].+)(\)|\])/i;function o(t){let e=(t=t.trim()).match(/^(\d+)x?\s+/);if(e){var r,o;const s=parseInt(e[1]),a=t.slice(e[0].length).replace(n,"").replace(i,"").trim(),l=null===(r=t.match(n))||void 0===r?void 0:r[2],c=null===(o=t.match(i))||void 0===o?void 0:o[0];return{name:a,amount:s,set:l,collectors:l&&c?parseInt(c):void 0}}throw new SyntaxError(`Invalid format: ${t}`)}function s(t){return[t.amount||1,a(t)].filter((t=>null!=t&&t)).join(" ")}function a(t){var e;return[t.name,null!==(e=t.set)&&void 0!==e&&e.length?`(${t.set})`:void 0,t.collectors].filter((t=>null!=t&&t)).join(" ")}function l(t){var e,r;let i=[];return t.commander&&(i.push("Commander"),i.push(t.commander.toCardString()),i.push("")),t.companion&&(i.push("Companion"),i.push(t.companion.toCardString()),i.push("")),null!==(e=t.deck)&&void 0!==e&&e.length&&(i.push("Deck"),t.deck.forEach((t=>{i.push(t.toCardString())})),i.push("")),null!==(r=t.sideboard)&&void 0!==r&&r.length&&(i.push("Sideboard"),t.sideboard.forEach((t=>{i.push(t.toCardString())})),i.push("")),i.join("\n")}class c{constructor(t){const{amount:e,name:r,set:i,collectors:n,mtgoID:o}="string"==typeof t?this.parseString(t):this.parseObject(t);this.name=r,this.amount=e,this.set=i,this.collectors=n,this.mtgoID=o}parseString(t){return o(t)}parseObject(t){var e,r,i;let n=t.collectors;"string"==typeof n&&(n=parseInt(n));let o=0|parseInt(null!==(e=t.Quantity)&&void 0!==e?e:t.amount);return(!o||!Number.isInteger(o)||o<0)&&(o=void 0),{name:null!==(r=t.Name)&&void 0!==r?r:t.name,amount:o,mtgoID:null!==(i=t.CatID)&&void 0!==i?i:t.mtgoID,set:t.set,collectors:n}}toCardString(){return s(this)}}class d{constructor(){r(this,"valid",!1),r(this,"deck",[]),r(this,"sideboard",[]),r(this,"companion",null),r(this,"commander",null),this.valid=!1}toDeckListString(){return l(this)}_newCardModel(t){return new c(t)}}const u=Symbol.for("DecklistType");var h,m;!function(t){t.mtgo="mtgo",t.mtga="mtga",t.mtgify="mtgify"}(h||(h={})),function(t){t[t.unstarted=0]="unstarted",t[t.commander=1]="commander",t[t.companion=2]="companion",t[t.deck=3]="deck",t[t.sideboard=4]="sideboard"}(m||(m={}));const p=/^deck$/i,g=/^sideboard$/i,f=/^commander$/i,v=/^companion$/i;class b extends d{constructor(e,i=!0){super(),r(this,u,"mtga");let n=t.lineSplit(e.toString().trim()),o=0;try{n.forEach((t=>{if((t=t.trim()).match(f))return void(o=1);if(t.match(v))return void(o=2);if(t.match(p))return void(o=3);if(0===o&&t.length>0)o=3;else{if(t.match(g)||3===o&&0===t.length)return void(o=4);if(0===t.length)return}let e=this._newCardModel(t);switch(o){case 1:this.commander=e;break;case 2:this.companion=e;break;case 3:this.deck.push(e);break;case 4:this.sideboard.push(e)}this.valid=!0}))}catch(t){this.valid=!1,i&&console.error(t)}}}class x extends d{constructor(t,i=!0){super(),r(this,u,"mtgo"),t=t.toString().trim();const n=e.validate(t);this.valid=!0===n,this.valid?e.parse(t,{attributeNamePrefix:"",ignoreAttributes:!1}).Deck.Cards.forEach((t=>{let e=this._newCardModel(t);"16777728"===t.Annotation?this.commander=e:"true"===t.Sideboard?this.sideboard.push(e):this.deck.push(e)})):i&&console.error(n.err)}}class S extends d{constructor(e,i=!0){super(),r(this,u,"mtgify");let n=t.lineSplit(e.toString().trim());try{n.forEach((t=>{var e;let r=(t=t.trim()).match(/^(\d+)x\s+(.+)$/);null!=r&&null!==(e=r[1])&&void 0!==e&&e.length&&this.deck.push(this._newCardModel(t))})),this.valid=this.deck.length>0}catch(t){this.valid=!1,i&&console.error(t)}}}function k(t){let e=new x(t,!1);if(e.valid)return e;if(e=new b(t,!1),e.valid)return e;let r=new S(t);return r.valid?r:e}exports.AbstractDeck=d,exports.CardModel=c,exports.Decklist=b,exports.MTGO=x,exports.MtgifyDecklist=S,exports.SymDecklistType=u,exports.autoParse=k,exports.default=k,exports.parseString=o,exports.toCardString=s,exports.toCardStringWithoutAmount=a,exports.toDeckListString=l,exports.toMtgifyCardString=function(t){return[(t.amount||1)+"x",t.name].filter((t=>null!=t&&t)).join(" ")};
//# sourceMappingURL=index.cjs.production.min.js.map
